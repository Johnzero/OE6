<%inherit file="fg_base.html"/>
<%block name="title">订单</%block>
<%block name="body">
        <style type="text/css">
            table
            {
                border-collapse:collapse;
            }
            table, td, th
            {
                border:1px solid #ccc;
            }
        </style>
        
		% if len(objects) > 1:
			不支持多单据下载.
		% else:
		<table width="600">
		<% 
            lines = dict()
            for line in objects[0].order_line:
                lines[line.product_id.code+line.color.color] = { 
                    'uom':line.product_uom, 
                    'qty': line.qty,
                    'code':line.product_id.code,
                    'color':line.color.color,
                    }
            def get_data(code, color):
                l = lines.get(code+color)
                if l:
                    return l['qty'], l['uom'].name
                return '', ''
        %>
		
		% for item in picking_items:
		        <% 
		            count = len(item['colors'])
		        %>
		        <tr>
	                <td rowspan="${ count }">${ item['category'] }</td>
    	            <td rowspan="${ count }">${ item['name'] }</td>
    	            <td rowspan="${ count }">${ item['code'] }</td>
    	            <td>${ item['colors'][0] }</td>
    	            <td>${ get_data(item['code'], item['colors'][0])[0] }</td>
    	            <td>${ get_data(item['code'], item['colors'][0])[1] }</td>
	            </tr>
	            % if count > 1:
	                % for i in range(1, count):
	                <tr>
	                    <td>${ item['colors'][i] }</td>
        	            <td>${ get_data(item['code'], item['colors'][i])[0] }</td>
        	            <td>${ get_data(item['code'], item['colors'][i])[1] }</td>
                    </tr>
	                % endfor 
	            % endif 
		% endfor

        </table>
        <script language="javascript" type="text/javascript">
		    var LODOP; //声明为全局变量
		    function SaveAsFile(){
            		LODOP=getLodop(document.getElementById('LODOP'),document.getElementById('LODOP_EM'));  
            		LODOP.SET_LICENSES("","292881049110510152101109126561","","");
            		LODOP.PRINT_INIT("");
            		LODOP.ADD_PRINT_TABLE(100,20,500,80,document.documentElement.innerHTML);
            		LODOP.SET_SAVE_MODE("QUICK_SAVE",true);//快速生成（无表格样式,数据量较大时或许用到）
            		LODOP.SAVE_TO_FILE("list.xls");
            		window.close();
            	};
            SaveAsFile()
		</script>
		% endif
</%block>